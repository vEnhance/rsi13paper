% This is paper.tex

\section{Introduction}
\textbf{Note:} If possible, this document should be printed in color.  However, I have left blue lines as solid and red lines as dashed for readability.

We study a class of maps between Bott-Samelson bimodules.  These maps are represented by certain types of diagrams, as described in section \ref{sec:prelim_map}.  The maps are composed by juxtaposition.

TODO: Expand on history, motivation, importance, etc. (meeting Ben on Monday)

Given a sequence consisting of the letters $s$ and $t$ of length $n$, as well as a binary string of length $n$, one can construct such a diagram using an algorithm known as Libedinsky's light leaves, as detailed in section \ref{sec:prelim_lightleave}.  Since two diagrams may be composed, we may construct a new map given two binary strings by composing the results of two applications of the light leaves.  We describe the relationship between the final result of such a composition and the two binary strings being composed.

Because the technical description of the problem statement is quite involved, we devote the entirety of section \ref{sec:prelim} to preliminaries and defer the actual problem statement to section \ref{sec:probstate}.  The results begin by solving the special case of one color completely in section \ref{sec:res_onecolor}.  In section \ref{sec:res_count_maps}, we also present a formula for the number of maps between two given bimodules.  The most interesting results are in sections \ref{sec:res_altcase} and \ref{sec:res_altrecurse}, where we investigate the case where the given string is $ststst\cdots$.  In particular, we show that the possible resulting structures is extremely limited, and provide a recursion based on these restrictions for special cases. 

\section{Preliminaries and Definitions}
\label{sec:prelim}
In section \ref{sec:prelim_background}, we provide the background behind the Bott-Samelson bimodules, and the correspondence between these maps and certain diagrams.  We then introduce Libedinsky's light leaves, a basis by which maps can be constructed using binary strings.

In section \ref{sec:prelim_def_notation}, we introduce several definitions which we use throughout the paper.  Next, in section \ref{sec:prelim_explain_poly_eval}, we describe how these maps can be represent as polynomials.  The actual problem statement is then deferred to \ref{sec:probstate}.
\subsection{An Extended Background}
\label{sec:prelim_background}
% \subsection{Coxeter Rings, and the Bott-Samelson Bimodules}
Let $W$ be a group with two generators $s$ and $t$ corresponding to reflecting over two hyperplanes in a real Euclidean space $V$, and let $\alpha_s$ and $\alpha_t$ be arbitrary vectors normal to these planes.  We will assume that the angle formed by $\alpha_s$ and $\alpha_t$ is not a rational multiple of $\pi$, so that the order of $st$ in $W$ is infinite.  In other words, $W$ is the infinite dihedral group with the presentation \[ W = \left<s,t \mid s^2=t^2=1\right>. \] If $V$ has a positive definite symmetric bilinear form $(\mu, \lambda)$, then each $v \in V$ is reflected over a hyperplane normal to any $a \in V$ via the map \[ v \mapsto v - \frac{2(v,a)}{(a,a)} a. \]  
In particular, if $W$ acts on $V$ by this reflection, $s(\alpha_s) = -\alpha_s$ and $t(\alpha_t) = -\alpha_t$.  Furthermore, using the above, we see that there exist fixed constants $x$ and $y$ such that
\begin{align*}
	s(\alpha_t) &= \alpha_t + x \alpha_s \\
	t(\alpha_s) &= \alpha_s + y \alpha_t
\end{align*}
Explicitly, $x = \frac{-2(\alpha_s,\alpha_t)}{(\alpha_s, \alpha_s)}$ and $y = \frac{-2(\alpha_t,\alpha_s)}{(\alpha_t,\alpha_t)}$.  Note that $x=y$ if $\left\lvert \alpha_s \right\rvert = \left\lvert \alpha_t \right\rvert$.

Now we define the \emph{Coxeter ring} by $R = \RR[\alpha_s, \alpha_t]$.  Then $W$ acts on $R$ by precisely the same algorithm as described above.

Let $R^s$ be the subring of $R$ which is invariant under $s$.  Define $R^t$ similarly.  Then a \emph{Bott-Samelson bimodule} is a bimodule of the form
\[ R \otimes_{R^{i_1}} R \otimes_{R^{i_2}} R \otimes_{R^{i_3}} \dots \otimes_{R^{i_n}} R, \]
where each $i_j$ is either $s$ or $t$.   Elements of such a bimodule will be written in the form $f_0 \mid f_1 \mid \dots \mid f_n$, where $f_i \in R$.

We will consider maps between these bimodules that preserve left and right actions; that is, we consider the maps $\sigma$ such that
\begin{equation}
	\sigma(rx) = r\sigma(x) \quad\text{and}\quad \sigma(xr) = \sigma(x)r \quad\text{for every $r \in R$ and $x \in \text{Domain } \sigma$}.
	\label{eq:respect}
\end{equation}
These maps can be represented using diagrammatics, as below.

\subsubsection{Diagrammatics of Maps}
\label{sec:prelim_map}
\newcommand{\DD}{\mathcal D}
Certain maps between Bott-Samelson bimodules can be described in terms of diagrams.  We take a detour and first describe the appearance of such diagrams; in the subsequent section we will explain their algebraic meaning.  A reader who is not interested in this context can simply accept on faith the relations specified in section \ref{sec:prelim_genrel}.

Consider a category $\DD$ whose elements are linear combinations $\sum c_i \square$ of the diagrams described below.  The coefficients $c_i$ belong to the ring $\ZZ[x,y]$.

The diagrams may be described as planar graphs, not necessarily connected, drawn in a rectangle, with the following properties.
\begin{enumerate}[(i)]
	\ii Vertices may lie on the upper or lower boundary, but not on the left or right boundary.
	\ii Each vertex has degree $1$ or $3$.
	\ii Each connected component is colored either blue or red.
\end{enumerate}
The vertices on the boundary are by convention not explicitly shown, but are nonetheless labelled $s$ or $t$ for blue or red, respectively.

\begin{figure}[ht]
	\centering
	\begin{asy}
	size(6cm);
	real xmax=7;
	real ymax=5;
	draw( (xmax,ymax)--(xmax,-ymax)--(-xmax,-ymax)--(-xmax,ymax)--cycle );
	pair apex = (0,2);
	path arc = (5,-5)..(2,0)..apex..(-2,0)..(-5,-5);
	draw(arc, blue);
	dot(apex, blue);
	draw(apex--(0,ymax), blue);
	draw(-apex--(0,-ymax), red + dashed + 0.6);
	dot(-apex, red);
	label("$s$", (0,ymax), dir(90));
	label("$t$", (0,-ymax), dir(270));
	label("$s$", (-5,-ymax), dir(270));
	label("$s$", (5,-ymax), dir(270));
	\end{asy}
	\caption{An example of a possible diagram.}
	\label{fig:example_diagram}
\end{figure}

An example of such a diagram is shown in figure \ref{fig:example_diagram}.

The elements of $\DD$ can be added by simply adding corresponding coefficients.  Multiplication is defined as follows: the product of two diagrams is the composition of the diagrams if the labels on the bottom of the first coincide with those on the top of the second.  Otherwise, the product is $0$.

In \cite{basispf}, Khovanov and Elias show that all such maps can be expressed as a linear combination of these diagrams.

\subsubsection{Algebraic Context}
The maps are conventionally read from bottom to top.  The labels on the upper and lower boundaries specify the domain and codomain of the map by simply transcribing the tensor products to take -- for example, a map with bottom $stt$ and top $s$ represents a map from $R \stimes R \ttimes R \ttimes R$ to $R \stimes R$.  An unlabelled domain corresponds to $R$.

Let us hasten to introduce one final definition.
\begin{definition*}
	The \emph{Demazure operator} $\partial_s: R \to R$ is given by $\partial_s(f) = \frac{f - sf}{\alpha_s}$.
\end{definition*}

With this, we can now describe the meanings of each type of vertex (for blue lines) in Table~\ref{tab:prim_maps}.  The corresponding equations hold for red in $t$.

\begin{table}[ht]
	\[
	\begin{array}{rll}
		\text{Map} & \text{Modules} & \text{Description} \\[1em]
		\barbell{half_top} & R \stimes R \to R & 1 \mid 1 \mapsto 1 \\[1em]
		\barbell{half_bot} & R \to R \stimes R & 1 \mapsto \half \left( 1 \mid \alpha_s + \alpha_s \mid 1 \right) \\[1em]
		\barbell{tri_down} & R \stimes R \to R \stimes R \stimes R & 1 \mid 1 \mapsto 1 \mid 1 \mid 1 \\[1em]
		\barbell{tri_up} & R \stimes R \stimes R \to R \stimes R & 1 \mid g \mid 1 \mapsto \partial_s(g) \mid 1 \\[1em]
		\barbell{id} & R \stimes R \to R \stimes R & 1 \mid 1 \mapsto 1 \mid 1 \\[1em]
	\end{array}
	\]
	\caption{Describing the maps.}
	\label{tab:prim_maps}
\end{table}

Note that the descriptions are sufficient to determine outputs for all values because these morphisms respect left and right actions, as prescribed in \eqref{eq:respect}.

Maps are composed by juxtaposition, and disjoint portions of the diagrams act independently.  Therefore, by a combination of these structures, we can generate arbitrarily complicated maps.  For example, the map in figure \ref{fig:example_diagram} represents a map \[ R \stimes R \ttimes R \stimes R \to R \stimes R \quad\text{by}\quad a \mid b \mid c \mid d \mapsto a \partial_s(bc) \mid d. \]

Henceforth, we will make the convenient abbreviation of $\barbell{tri_up_contract_before}$ as $\barbell{tri_up_contract_after}$.  It will also be understood that edges need not be straight lines, but any topologically equivalent deformation shall represent the same graph.  With this understanding, any of the graphs described in the previous section can be viewed as compositions of the primitive structures we describe here.

% Subsequently, for any polynomial $f \in R$ we will abuse notation and refer to the map $x \mapsto fx$ by simply $f$.  In particular, one can easily verify that $\barbell{barbell_blue}$ represents $\alpha_s$.  Note that this is \emph{not} in general the same as $x \mapsto xf$ because $x$ may belong to some bimodule rather than to $R$.  Phrased diagrammatically, $\barbell{alpha_blue}\barbell{barbell_blue} \neq \barbell{barbell_blue}\barbell{alpha_blue} = \alpha_s$, for instance.

\subsubsection{Operations for Diagrammatics}
\label{sec:prelim_genrel}
From the algebraic context given above, one can derive the following relationships, which are here encoded completely graphically.  These rules are sufficient to compute the maps we are interested in.

\setcounter{op}{-1}
\begin{op}[Isotropy] If two diagrams can be continuously deformed into each other (in the topological sense), then they are equivalent.  \end{op}
\begin{op}[Associativity] We have $\barbell{assoc_horiz} = \barbell{assoc_vert}$ and the similar equation for red.  \end{op}
\begin{op}[Contraction] We have $\barbell{contract_left} = \barbell{contract_right} = \barbell{alpha_blue}$ and the similar equation for red.  \end{op}
\begin{op}[The Needle] We have $\barbell{needle} = 0$.  Similarly, the red needle yields zero.  \end{op}
\begin{remark*} Using contraction and the above, one can show that the diagram $\barbell{zero}$ is zero as well. In fact, in general, \emph{any} map which contains a ``closed'' and empty region is the zero map.  \end{remark*}
\begin{op}[Barbell-Forcing Rules]
	We have the following three equalities:
	\begin{enumerate}[(a)]
		\ii $\barbell{barbell_blue}\barbell{alpha_blue} + \barbell{alpha_blue} \barbell{barbell_blue} = 2 \barbell{break_blue}$, and the similar equation for red.
		\ii $\barbell{alpha_red}\barbell{barbell_blue} = -x\barbell{break_red} + \barbell{barbell_blue}\barbell{alpha_red} + x \barbell{barbell_red}\barbell{alpha_blue}$.
		\ii $\barbell{alpha_blue}\barbell{barbell_red} = -y\barbell{break_blue} + \barbell{barbell_red}\barbell{alpha_blue} + y \barbell{barbell_blue}\barbell{alpha_red}$.
	\end{enumerate}
\end{op}

% Furthermore, one can again verify that $\barbell{barbell_blue}$, when on the far left, is simply $\alpha_s$.


\subsubsection{Libedinsky's Light Leaves}
\label{sec:prelim_lightleave}
\begin{figure}[ht]
	\centering
	\begin{asy}
	size(10cm);
	real h = 0.7;
	pen s = blue, t = dashed + red + 0.6;
	int n = 14;
	draw(currentpicture, (0,0)--(0,h/2)..((0+2)/2.0,h*2)..(2,h/2)--(2,0), s);
	draw(currentpicture, (2,0)--(2,h/2)..((2+3)/2.0,h*1)..(3,h/2)--(3,0), s);
	draw(currentpicture, (5,0)--(5,h/2)..((5+6)/2.0,h*1)..(6,h/2)--(6,0), s);
	draw(currentpicture, (4,0)--(4,h/2)..((4+8)/2.0,h*4)..(8,h/2)--(8,0), t);
	draw(currentpicture, (8,0)--(8,h/2)..((8+9)/2.0,h*1)..(9,h/2)--(9,0), t);
	draw(currentpicture, (11,0)--(11,h/2)..((11+13)/2.0,h*2)..(13,h/2)--(13,0), t);
	draw(currentpicture, (1,0)--(1,h), t);dot(currentpicture, (1,h), red);
	draw(currentpicture, (7,0)--(7,h), s);dot(currentpicture, (7,h), s);
	draw(currentpicture, (12,0)--(12,h), s);dot(currentpicture, (12,h), s);
	draw(currentpicture,(9,0)--(9,5*h), t);
	draw(currentpicture,(10,0)--(10,5*h), s);
	dot(currentpicture, (2, h/2), blue);
	dot(currentpicture, (8, h/2), red);
	dot(currentpicture, (9, h/2), red);
	label(currentpicture, "1", (0,-1.5h), dir(90));
	label(currentpicture, "s", (0,-0.8*h), dir(90));
	label(currentpicture, "0", (1,-1.5h), dir(90));
	label(currentpicture, "t", (1,-0.8*h), dir(90));
	label(currentpicture, "0", (2,-1.5h), dir(90));
	label(currentpicture, "s", (2,-0.8*h), dir(90));
	label(currentpicture, "1", (3,-1.5h), dir(90));
	label(currentpicture, "s", (3,-0.8*h), dir(90));
	label(currentpicture, "1", (4,-1.5h), dir(90));
	label(currentpicture, "t", (4,-0.8*h), dir(90));
	label(currentpicture, "1", (5,-1.5h), dir(90));
	label(currentpicture, "s", (5,-0.8*h), dir(90));
	label(currentpicture, "1", (6,-1.5h), dir(90));
	label(currentpicture, "s", (6,-0.8*h), dir(90));
	label(currentpicture, "0", (7,-1.5h), dir(90));
	label(currentpicture, "s", (7,-0.8*h), dir(90));
	label(currentpicture, "0", (8,-1.5h), dir(90));
	label(currentpicture, "t", (8,-0.8*h), dir(90));
	label(currentpicture, "0", (9,-1.5h), dir(90));
	label(currentpicture, "t", (9,-0.8*h), dir(90));
	label(currentpicture, "1", (10,-1.5h), dir(90));
	label(currentpicture, "s", (10,-0.8*h), dir(90));
	label(currentpicture, "1", (11,-1.5h), dir(90));
	label(currentpicture, "t", (11,-0.8*h), dir(90));
	label(currentpicture, "0", (12,-1.5h), dir(90));
	label(currentpicture, "s", (12,-0.8*h), dir(90));
	label(currentpicture, "1", (13,-1.5h), dir(90));
	label(currentpicture, "t", (13,-0.8*h), dir(90));
	\end{asy}
	\caption{An example of light leaves.}
	\label{fig:lightleaf_example}
\end{figure}

Fix an expression $\ul r$ of $s$'s and $t$'s with length $n$.  Then for any binary string $\ul b$ of length $n$, we can construct a diagram based on a series of rules.

Each bit of $\ul b$ is read from left to right in order and designated either up or down.  We say that a bit $x$ is an \emph{open neighbor} of $y$ if $x$ is marked up, $x$ and $y$ have the same color, and there are no other bits marked up between $x$ and $y$.
\begin{itemize}
	\ii If the bit is a $1$:
	\begin{itemize}
		\ii If the current bit has an open neighbor, then draw an arc joining the two bits, and mark both bits as down.
		\ii Otherwise, designate the current bit as up.
	\end{itemize}
	\ii If the bit is $0$:
	\begin{itemize}
		\ii If the current bit has an open neighbor, then draw an arc joining the two bits, mark the previous bit as down, and the current bit as up.
		\ii Otherwise, create a ``stub'', i.e. a single vertex of degree one, and mark the current bit as down.
	\end{itemize}
\end{itemize}
Finally, join any bits which are up at the end of the process to the opposite end.  A map which arises in such a manner is called a \emph{light leaf}.  An example of such a light leaf is shown in figure \ref{fig:lightleaf_example}.

These light leaves are interesting because, in the seventh chapter of \cite{span}, it is shown that these light leaves form a ``basis'' in the sense that all maps may be expressed by compositions of these light leaves.

\subsection{Definitions and Notations}
\label{sec:prelim_def_notation}
\subsubsection{Notations for Strings}
For each positive integer $n$, let us define for convenience the strings
\[ \SS_n \defeq \underbrace{s \dots s}_{\text{$n$ $s$'s}} \] 
and the ``alternating'' string
\[
	\AA_n \defeq
	\begin{cases}
		\underbrace{sts\dots s}_{\text{$n$ letters}} & \text{if } n \equiv 1 \pmod{2} \\
		\underbrace{sts\dots t}_{\text{$n$ letters}} & \text{if } n \equiv 0 \pmod{2} \\
	\end{cases}.
\]
Similarly, let $\AA_n'$ denote $\AA_n$, except with the roles of $s$ and $t$ switched.  Note that $\AA_0 = \AA_0' = \varnothing$.

In general, a string of $s$'s and $t$'s will be referred to as an \emph{expression}.  In the case where there are no consecutive identical characters (e.g. $\AA_n$), we will refer to them as \emph{reduced expressions}.

Next, let $\BB_n$ denote the set of binary strings of length $n$.

Finally, given a string $\ul x$ (either a binary string or a string of $s$'s and $t$'s) we will denote the $i\th$ character as $\ul x[i]$.

\subsubsection{Definitions for Maps and Diagram}
Consider a string $\ul r$ of letters $s$ and $t$.  Given a binary string $\ul b$, we will let $\MM_{\ul r}(\ul b)$ denote the map (or its associated diagram; we will refer to maps and their associated diagrams interchangably) formed by the light leaves.  We will refer to such structures as \emph{half-maps} or \emph{half-diagrams} should such a need arise.  Additionally, let $\Top_{\ul r} \ul b$ denote the top of the half-diagram $\MM_{\ul r}(\ul b)$.

\begin{figure}[ht]
	\centering
	\begin{asy}
	size(4cm);
	real h = 0.7;
	pen s = blue, t = red + dashed + 0.6;
	pen dot_s = blue, dot_t = red;
	int n = 7;

	picture one;
	draw(one, (0,0)--(0,h/2)..((0+3)/2.0,h*3)..(3,h/2)--(3,0), s);
	draw(one, (4,0)--(4,h/2)..((4+6)/2.0,h*2)..(6,h/2)--(6,0), t);
	draw(one, (1,0)--(1,h), t);
	dot(one, (1,h), dot_t);
	draw(one, (2,0)--(2,h), t);
	dot(one, (2,h), dot_t);
	draw(one, (5,0)--(5,h), s);
	dot(one, (5,h), dot_s);
	draw(one,(6,0)--(6,4*h), t);
	dot(one, (6, h/2), dot_t);

	picture two;
	draw(two, (0,0)--(0,h/2)..((0+3)/2.0,h*3)..(3,h/2)--(3,0), s);
	draw(two, (1,0)--(1,h), t);
	dot(two, (1,h), dot_t);
	draw(two, (2,0)--(2,h), t);
	dot(two, (2,h), dot_t);
	draw(two, (4,0)--(4,h), t);
	dot(two, (4,h), dot_t);
	draw(two, (5,0)--(5,h), s);
	dot(two, (5,h), dot_s);
	draw(two,(6,0)--(6,4*h), t);

	add(one); add(reflect((0,0),(1,0))*two);
	draw((-1,0)--(7,0));
	\end{asy}
	\caption{An example of composing two maps, $\MM_{sttstst}(1001100)$ and $\MM_{sttstst}(1001001)$.}
	\label{fig:example_compose}
\end{figure}

Two maps $\MM_{\ul r}(\ul a)$ and $\MM_{\ul r}(\ul b)$ with identical tops may be composed by juxtaposing $\MM_{\ul r}(\ul a)$ with a flipped copy of $\MM_{\ul r}(\ul b)$; an example of such a composition is given in Figure~\ref{fig:example_compose}.  We will denote this product by $\MM_{\ul r}(\ul a, \ul b)$. % Then given two binary strings $\ul a$ and $\ul b$, we will let $\MM_{\ul r}(\ul a, \ul b)$ denote the product of $\MM_{\ul r}(\ul a)$ and $\MM_{\ul r}(\ul b)$ if $\Top_{\ul r} \ul a = \Top_{\ul r} \ul b$, and $0$ otherwise.  

Such structures will analogously be called \emph{full-maps} or \emph{full-diagrams} for clarity.  If $\ul r$ is clear from context, we will abbreviate $\MM_{\ul r}$ as simply $\MM$ and $\Top_{\ul r}$ as $\Top$.

Recall that the light leaves are based off a sequence of vertices at the bottom boundary of a half-map.  We will call those vertices, whether on the bottom boundary of a half-map or the center of a full-map, the \emph{anchors} for that map, and the associated sequence of letters the \emph{base}.  Furthermore, the line on which the anchors lie will be called the \emph{anchorline}.

An example of a full-map with base $\AA_5$ is given in figure \ref{fig:example_full_map}.

\begin{figure}[ht]
	\centering
	\begin{asy}
		size(4cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 5;

		picture one;
		draw(one, (0,0)--(0,h/2)..((0+2)/2.0,h*2)..(2,h/2)--(2,0), s);
		draw(one, (1,0)--(1,h), t);
		dot(one, (1,h), dot_t);
		draw(one, (3,0)--(3,h), t);
		dot(one, (3,h), dot_t);
		draw(one, (4,0)--(4,h), s);
		dot(one, (4,h), dot_s);

		picture two;
		draw(two, (1,0)--(1,h/2)..((1+3)/2.0,h*2)..(3,h/2)--(3,0), t);
		draw(two, (0,0)--(0,h/2)..((0+4)/2.0,h*4)..(4,h/2)--(4,0), s);
		draw(two, (2,0)--(2,h), s);
		dot(two, (2,h), dot_s);

		add(one); add(reflect((0,0),(1,0))*two);
		draw((-1,0)--(5,0));
	\end{asy}
	\caption{A full-map with base $ststs$, hence with five anchors.  The top is $\varnothing$.}
	\label{fig:example_full_map}
\end{figure}

% We will now abuse notation further and refer even to components by polynomials, when the map is left alone.  For example, $\barbell{alpha_blue}\barbell{barbell_blue}\barbell{barbell_blue}\barbell{barbell_red}$ might be referred interchangeably with $\barbell{alpha_blue} \alpha_s^2 \alpha_t$.  Note that, even though we may write $\barbell{alpha_blue} = 1$, we still have $\barbell{alpha_blue} \alpha_s^2\alpha_t \neq \alpha_s^2\alpha_t$, because we strictly require left multiplication as the accepted convention.

\subsubsection{Nomenclature for Certain Structures in Diagrams}
Let us make a few convenient definitions.

\begin{figure}[ht]
	\centering
	\begin{asy}
		size(5cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 10;

		picture one;
		draw(one, (4,0)--(4,h/2)..((4+6)/2.0,h*2)..(6,h/2)--(6,0), s);
		draw(one, (3,0)--(3,h/2)..((3+7)/2.0,h*4)..(7,h/2)--(7,0), t);
		draw(one, (2,0)--(2,h/2)..((2+8)/2.0,h*6)..(8,h/2)--(8,0), s);
		draw(one, (1,0)--(1,h/2)..((1+9)/2.0,h*8)..(9,h/2)--(9,0), t);
		draw(one, (5,0)--(5,h), t);
		dot(one, (5,h), dot_t);
		draw(one,(0,0)--(0,9*h), s);

		picture two;
		draw(two, (2,0)--(2,h/2)..((2+4)/2.0,h*2)..(4,h/2)--(4,0), s);
		draw(two, (1,0)--(1,h/2)..((1+5)/2.0,h*4)..(5,h/2)--(5,0), t);
		draw(two, (0,0)--(0,h/2)..((0+6)/2.0,h*6)..(6,h/2)--(6,0), s);
		draw(two, (3,0)--(3,h), t);
		dot(two, (3,h), dot_t);
		draw(two, (7,0)--(7,h), t);
		dot(two, (7,h), dot_t);
		draw(two, (9,0)--(9,h), t);
		dot(two, (9,h), dot_t);
		draw(two,(8,0)--(8,7*h), s);

		add(one); add(reflect((0,0),(1,0))*two);
		draw((-1,0)--(10,0));
	\end{asy}
	\caption{Two blue barbells with a very twisted fence, which creates two pastures.}
	\label{fig:def_barbell_fence}
\end{figure}

\begin{definition*}
	A connected component which (i) is a tree, and (ii) does not touch the top or bottom boundaries is called a \emph{barbell}.
\end{definition*}
Notice that, by homotopy, every blue barbell is simply $\barbell{barbell_blue}$, which we will see later evaluates as $\alpha_s$.  Similarly, every red barbell is simply $\barbell{barbell_red} = \alpha_t$.

\begin{definition*}
	A \emph{fence} is a contiguous path which runs from the top of the boundary to the bottom of the boundary (i.e. paths between the labelled vertices).  The diagram is divided by these fences into \emph{pastures}, which will be numbered from left to right as $0$, $1$, \dots, $k$, where $k$ is the number of fences.  
\end{definition*}
\begin{definition*}
	A component is called \emph{attached} if it is connected to a fence.  Otherwise, it is \emph{free}.  By convention, any attached components belong to the pasture to the left of the associated fence.
\end{definition*}
An example of a fence complete with two barbells is given in figure \ref{fig:def_barbell_fence}.

Next, we name some recurrent characters in our work.

% We remind the reader that we are working modulo lower terms; any map which contains a ``half fence'' (i.e. a connected component which touches a boundary exactly once) is not considered.

\begin{figure}[ht]
	\centering
	\begin{asy}
		size(4cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 4;

		picture one;
		draw(one, (0,0)--(0,h/2)..((0+3)/2.0,h*3)..(3,h/2)--(3,0), s);
		draw(one, (1,0)--(1,h), t);
		dot(one, (1,h), dot_t);
		draw(one, (2,0)--(2,h), t);
		dot(one, (2,h), dot_t);

		picture two;
		draw(two, (0,0)--(0,h/2)..((0+3)/2.0,h*3)..(3,h/2)--(3,0), s);
		draw(two, (1,0)--(1,h), t);
		dot(two, (1,h), dot_t);
		draw(two, (2,0)--(2,h), t);
		dot(two, (2,h), dot_t);

		add(one); add(reflect((0,0),(1,0))*two);
		draw((-1,0)--(4,0));
	\end{asy}
	\caption{A blue bubble with two barbells inside it.}
	\label{fig:def_bubble}
\end{figure}

\begin{definition*}
	A \emph{bubble} is a bounded face alongside with any components contained within it.  The \emph{color} of the bubble is the color of the edges which form the bounded face.  
\end{definition*}
\begin{definition*}
	We say that the bubble $B$ \emph{holds} a component $c$ if $c$ is inside $B$, but there is no other bubble $B'$ inside $B$ which contains $c$.  
\end{definition*}

An example of a bubble is given in figure~\ref{fig:def_bubble}.

\begin{figure}[ht]
	\centering
	\begin{asy}
		size(6cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 7;

		picture one;
		draw(one, (0,0)--(0,h/2)..((0+2)/2.0,h*2)..(2,h/2)--(2,0), s);
		draw(one, (2,0)--(2,h/2)..((2+4)/2.0,h*2)..(4,h/2)--(4,0), s);
		draw(one, (4,0)--(4,h/2)..((4+6)/2.0,h*2)..(6,h/2)--(6,0), s);
		draw(one, (1,0)--(1,h), t);
		dot(one, (1,h), dot_t);
		draw(one, (3,0)--(3,h), t);
		dot(one, (3,h), dot_t);
		draw(one, (5,0)--(5,h), t);
		dot(one, (5,h), dot_t);
		dot(one, (2, h/2), dot_s);
		dot(one, (4, h/2), dot_s);

		picture two;
		draw(two, (0,0)--(0,h/2)..((0+2)/2.0,h*2)..(2,h/2)--(2,0), s);
		draw(two, (2,0)--(2,h/2)..((2+4)/2.0,h*2)..(4,h/2)--(4,0), s);
		draw(two, (4,0)--(4,h/2)..((4+6)/2.0,h*2)..(6,h/2)--(6,0), s);
		draw(two, (1,0)--(1,h), t);
		dot(two, (1,h), dot_t);
		draw(two, (3,0)--(3,h), t);
		dot(two, (3,h), dot_t);
		draw(two, (5,0)--(5,h), t);
		dot(two, (5,h), dot_t);
		dot(two, (2, h/2), dot_s);
		dot(two, (4, h/2), dot_s);

		add(one); add(reflect((0,0),(1,0))*two);
		draw((-1,0)--(7,0));
	\end{asy}
	\caption{A caterpillar made of three bubbles}
	\label{fig:def_caterpillar}
\end{figure}

\begin{definition*}
	A \emph{caterpillar} consists of a free component and the contents of any bubbles it contains.  A caterpillar \emph{holds} a component if some bubble of the caterpillar holds it.
\end{definition*}
An example of a caterpillar is given in figure~\ref{fig:def_caterpillar}.  Notice that any barbell or bubble is a special case of a caterpillar.


\subsection{Representations of Maps as Polynomials}
\label{sec:prelim_explain_poly_eval}

In order to study these maps as algebraic structures, we wish to consider full-maps as polynomials in $\RR[x,y][\alpha_s,\alpha_t]$.  Hence, we establish the following conventions:
\begin{enumerate}
	\ii The map $x \mapsto fx$ will be abbreviated as $f$ from this point forward.  
	\par Note that, in particular, $\barbell{barbell_blue} = \alpha_s$.  Furthermore, one can check that, say, $\barbell{barbell_blue}\barbell{barbell_blue}\barbell{barbell_red}\barbell{alpha_blue} = \alpha_s^2 \alpha_t$.  
	Please note that $x \mapsto xf$ does not get a similar abbreviation.  So, $\barbell{alpha_blue}\barbell{barbell_blue} \neq \alpha_s$.
	\ii We will work \emph{modulo lower terms}.  That is, any map which contains a connected component that touches any boundary only once (total) is considered zero.  So, for example, $\barbell{break_blue} = 0$.
\end{enumerate}
Henceforth, we will refer to diagrams and their associated polynomials interchangeably.

One can verify that, using the barbell-forcing rules, we can recursively move all barbells to the left, and any ``broken'' walls are reduced to zero, or are contracted.  Hence, any full-diagram can be reduced to linear combinations of maps of the form $f \mapsto \alpha_s^m \alpha_t^n f$.  In other words, every full diagram can be represented as a polynomial in $\RR[x,y][\alpha_s,\alpha_t]$.

In fact, we can even show that, with this new convention, that the following identity holds for every $f$:
\begin{equation}
	\barbell{alpha_blue} f = \partial_s(f) \barbell{break_blue} + s(f) \barbell{alpha_blue}
	\label{eq:barbell_break}
\end{equation}
where $\partial_s$ is the Demazure operator defined in section \ref{sec:prelim_genrel}.

\subsubsection{Quantum Numbers}
A particularly nice sequence of polynomials involved can be defined recursively.  They are termed \emph{two-color quantum numbers}.
\begin{definition*}[Quantum Numbers]
	For each integer $n \ge 0$, define two polynomials $[n]_x, [n]_y \in \ZZ[x,y]$ recursively by $[0]_x = [0]_y = 0$, $[1]_x = [1]_y = 1$, $[2]_x = x$, $[2]_y = y$, and
	\begin{align*}
		[2]_x[n]_y = [n+1]_x - [n-1]_x \\
		[2]_y[n]_x = [n+1]_y - [n-1]_y
	\end{align*}
	Finally, $[-n]_x = -[n]_x$ and $[-n]_y = -[n]_y$ for each $n \ge 0$.
\end{definition*}
The quantities $[n]_x$ and $[n]_y$ are closely related.  In particular, $[2k+1]_x = [2k+1]_y$ and $[2]_x[2k]_y = [2]_y[2k]_x$ for all integers $k$.

The quantum numbers are relevant to the problem because of the identity
\begin{equation}
	s([n]_x\alpha_s + [n-1]_y\alpha_t) = [n]_x\alpha_s + [n+1]_y\alpha_t
	\label{eq:quantum}
\end{equation}
and its analogous form for $t$.  One can verify \eqref{eq:quantum} immediately follows from definitions.  This allows us to recursively compute the polynomial which results from pushing a barbell through multiple alternating fences.  For example, $ststst(\alpha_s) = ststst([1]_x\alpha_s + [0]_y\alpha_t) = [7]_x\alpha_s + [6]_y\alpha_t$.

\section{Problem Statement}
\label{sec:probstate}

The motivation for this problem arises from the following definition.
\begin{definition*}
	A map is \emph{idempotent} if multiplying it with itself returns the original graph.
\end{definition*}
Colloquially, $m^2=m$ if and only if $m$ is idempotent.

Fix an $\ul r$.  If we can find two maps $A$ and $B$ for which $AB$ is the identity, then $(BA)^2=BABA=BA$ will be an idempotent.  This motivates us to construct potential idempotents by taking two light leaves whose top sequences are identical, and composing $A$ upside-down with $B$.  If $AB=1$, then this will yield an idempotent.

This motivates the main objective of study.
\begin{ques*}
	For a fixed $\ul r$ and two binary sequences $\ul a$ and $\ul b$ with $\Top_{\ul r} \ul a = \Top_{\ul r} \ul b$, find a formula for $\MM_{\ul r}(\ul a, \ul b)$ in terms of $\ul r$, $\ul a$, and $\ul b$.
\end{ques*}
Here, we are interested in computing the polynomial which corresponds to this map.

\section{A Complete Characterization of the One-Color Case}
\label{sec:res_onecolor}
In this section we provide a complete characterization for the $\MM_{\SS_n}(\ul a, \ul b)$.  % The proof is effectively trivial, but requires some rather irritating details and definitions in order to be clear.

First, we need a criteria to determine the top.  Fortunately, this is extremely easy.
\begin{definition*}
	For a binary string $\ul b$, let $\pi_1(\ul b)$ denote the number of $1$'s in $\ul b$, and $\pi_0(\ul b)$ the number of $0$'s.
\end{definition*}
\begin{proposition}
	For any $\ul b$ of length $n$, \[
		\Top_{\SS_n} \ul b =
		\begin{cases}
			\varnothing & \text{if } \pi_1(\ul b) \equiv 0 \pmod{2} \\
			s & \text{if } \pi_1(\ul b) \equiv 1 \pmod{2} \\
		\end{cases}.
		\]
	\label{prop:s_top}
\end{proposition}
\begin{proof}
	Straightforward induction on $n$.  
\end{proof}

Subsequently, we make the following definition.
\begin{definition*}
	For a binary string $\ul b$, define the \emph{partial-sum string} of $\ul b$, denoted $\ul b^\ast$, as follows:
	\[
		\ul b^\ast [i] = 
		\begin{cases}
			1 & \text{if } \ul b[1] + \ul b[2] + \dots + \ul b[i] \equiv 1 \pmod{2} \\
			0 & \text{otherwise}
		\end{cases}.
	\]
\end{definition*}
This lets us state our main result for this section.
\begin{theorem}
	If $\ul a, \ul b \in \BB_n$ obey $\Top_{\SS_n} \ul a = \Top_{\SS_n} \ul b$, then
	\[
		\MM_{\SS_n} \left( \ul a, \ul b \right)
		=
		\begin{cases}
			0 & \text{if }\ \exists 1 \le i \le n-1:\ \ul a^\ast[i] = \ul b^\ast[i] = 1 \\
			\alpha_s^{n - \pi_1(\ul a^\ast) - \pi_1(\ul b^\ast) - \ul a^\ast[n]} & \text{otherwise}
		\end{cases}.
	\]
	\label{thm:s_eval}
\end{theorem}
\begin{figure}[ht]
	\centering
	\begin{asy}
		size(7cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 8;
		draw(currentpicture, (0,0)--(0,h/2)..((0+1)/2.0,h*1)..(1,h/2)--(1,0), s);
		draw(currentpicture, (1,0)--(1,h/2)..((1+2)/2.0,h*1)..(2,h/2)--(2,0), s);
		draw(currentpicture, (2,0)--(2,h/2)..((2+3)/2.0,h*1)..(3,h/2)--(3,0), s);
		draw(currentpicture, (5,0)--(5,h/2)..((5+6)/2.0,h*1)..(6,h/2)--(6,0), s);
		draw(currentpicture, (4,0)--(4,h), s);
		dot(currentpicture, (4,h), dot_s);
		draw(currentpicture, (7,0)--(7,h), s);
		dot(currentpicture, (7,h), dot_s);
		dot(currentpicture, (1, h/2), dot_s);
		dot(currentpicture, (2, h/2), dot_s);
		label(currentpicture, "1", (0,-1.5h), dir(90));
		label(currentpicture, "s", (0,-0.8*h), dir(90));
		label(currentpicture, "0", (1,-1.5h), dir(90));
		label(currentpicture, "s", (1,-0.8*h), dir(90));
		label(currentpicture, "0", (2,-1.5h), dir(90));
		label(currentpicture, "s", (2,-0.8*h), dir(90));
		label(currentpicture, "1", (3,-1.5h), dir(90));
		label(currentpicture, "s", (3,-0.8*h), dir(90));
		label(currentpicture, "0", (4,-1.5h), dir(90));
		label(currentpicture, "s", (4,-0.8*h), dir(90));
		label(currentpicture, "1", (5,-1.5h), dir(90));
		label(currentpicture, "s", (5,-0.8*h), dir(90));
		label(currentpicture, "1", (6,-1.5h), dir(90));
		label(currentpicture, "s", (6,-0.8*h), dir(90));
		label(currentpicture, "0", (7,-1.5h), dir(90));
		label(currentpicture, "s", (7,-0.8*h), dir(90));
	\end{asy}
	\caption{A half-map with base $\SS_8$.}
	\label{fig:pf_trivial_theorem_example}
\end{figure}
\begin{proof}
	We will only consider the case where $\Top \ul a = \varnothing$, so that $\ul a^\ast[n] = \ul b^\ast[n] = 0$; the other case is essentially identical.  See figure \ref{fig:pf_trivial_theorem_example} for a example of such a map.

	Number the anchors $1$, $2$, \dots from left to right.

	For a half-map $\MM(\ul b)$, define the \emph{antennae} of a connected component to be the anchors which it touches.  Note that the antennae of a component always form a single contiguous sequence of anchors.

	The key observation is that for $1 \le i \le n-1$, we have that $\ul b^\ast[i] = 1$ if and only if $i$ and $i+1$ are both antennae of some component in $\MM(\ul b)$.  This follows by construction.

	Let us now compose $M_a \defeq \MM(\ul a)$ and $M_b \defeq \MM(\ul b)$ to obtain a full-map.  Two components (one from $M_a$ and one from $M_b$) are said to \emph{feel} each other $k$ times if they have $k$ antennae in common.  Notice that if any two components feel each other at least twice, then there exist two adjacent antennae, whence the composition of the map is zero because the two antenna combine to form an empty bubble.  Furthermore, it is easy to see that any bubbles must be formed in this manner.  In combination with the claim above, this implies the first case of the theorem.

	On the other hand, suppose this product is nonzero, and consider a component from the top with $k$ antennae.  We claim that there are $n - \pi_1(\ul a^\ast) - \pi_1(\ul b^\ast)$ trees; this would complete the proof, because each tree contracts to a barbell.  Notice that $\pi_1(\ul a^\ast) + \pi_1(\ul b^\ast)$ counts the number of edges between adjacent anchors ($i$ and $i+1$).  Because there are no cycles, deleting one of these edges increases the number of connected components by exactly one (since all the connected components are trees).  If we delete all such edges, then we obtain $n$ barbells.  Therefore there must have been $n - \pi_1(\ul a^\ast) - \pi_1(\ul b^\ast)$ trees to begin with, as desired.
\end{proof}

\section{Counting Maps}
\label{sec:res_count_maps}
We give a formula for the number of binary strings $\ul b$ such that $\Top_{\ul r} \ul b = \ul T$ for each expression $\ul T$ and $\ul r$.  One can check that, by construction, $\Top \ul b$ is always a reduced expression.

\begin{definition*}
	Let $R(\ul r)$ denote $\ul r$ with any consecutive blocks of $s$'s replaced by a single $s$, and similarly for $t$.
\end{definition*}
For example, $R(sststttts) = ststs$.

\begin{proposition}
	Let $\ul r$ be an expression of length $\ell$, and suppose $R(\ul r) = \AA_n$.
	\begin{enumerate}[(i)]
		\ii If $n=2k+1$ is odd, then for each $0 \le m \le k$, there are $2^{\ell-n} \binom{2k}{m+k}$ binary strings $\ul b$ yielding each of $\AA_{2m+1}$, $\AA_{2m}$, $\AA_{2m-1}'$, and $\AA_{2m}'$ as $\Top_{\ul r} \ul b$.
		\ii If $n=2k$ is even, then for each $0 \le m \le k-1$, there are $2^{\ell-n} \binom{2k-1}{m+k}$ binary strings $\ul b$ yielding each of $\AA_{2m+1}$, $\AA_{2m+2}$, $\AA_{2m}'$, and $\AA_{2m+1}'$ as $\Top_{\ul r} \ul b$.
	\end{enumerate}
	\label{thm:count_maps}
\end{proposition}
Of course, if $\ul r$ begins with the character $t$, then one can simply reverse the roles of $s$ and $t$ in the above theorem to obtain an analogous formula.

The main idea of the proof is to reduce the problem to the case when $\ell = n$, and then apply induction on $n$.  We fill in the details below.

\begin{proof}[Proof of Proposition \ref{thm:count_maps}]
	First we will resolve the case where $\ul r = \AA_n$, so that $\ell = n$ and $2^{\ell-n} = 1$.  This follows by induction on $n$.  The main idea is that, for the binary strings of length $n$, we consider those that end with $1$ and those that end with $0$.  Those that end with a $0$ have the same top when the trailing $0$ is deleted, whilst those with end bit $1$ have a top which differs by one character if the trailing $1$ is deleted.  We simply check that in all eight cases, the binomial coefficients add up to give the new binomial coefficients (via Pascal's identity).  The computation is left to a reader.

	To finish to all cases, we note that we can treat each consecutive block of $s$'s of length $m$ as a single $s$, where there a $2^{m-1}$ ways to get a $1$ and $2^{m-1}$ ways to get a $0$.  (This follows from Proposition \ref{prop:s_top}.)  This reduces to the previous case $\ul r = \AA_n$, but with some extra factors of $2$; aggregating all of them yields the factor of $2^{\ell-n}$, as desired.
\end{proof}

\section{Constraints in the Alternating Case}
\label{sec:res_altcase}
We now turn our attention to the case of $\ul r = \AA_n$.

In this section we will show several results which show that the possible outputs of a map with base $\AA_n$ are extremely restricted.  We present them below, before providing proofs of each.
\begin{theorem}[Bubble Theorem]
	Consider a bubble in a full-diagram with base $\AA_n$.  The bubble holds exactly one caterpillar, whose color is opposite that of the bubble.
	\label{thm:bubble}
\end{theorem}
\begin{theorem}[Caterpillar Theorem]
	Any caterpillar in a full-diagram with base $\AA_n$ evaluates in the form $x^my^n\alpha_s$ if it is blue, or $x^my^n\alpha_t$ is red.
	\label{thm:caterpillar}
\end{theorem}
\begin{theorem}[Pasture Theorem]
	Consider a full-diagram with $N+1$ pastures (numbered $0$, $1$, \dots, $N$) with base $\AA_n$ and top $T$.  Suppose further that $N \ge 1$ (or equivalently, $T \neq \varnothing$).  Then:
	\begin{enumerate}[(i)]
		\ii Pastures $1$ through $N-1$ contain either nothing or an attached component.
		\ii Pasture $N$ contains nothing if $T[N] = \AA_n[n]$, and contains a single caterpillar otherwise.
	\end{enumerate}
	\label{thm:pasture}
\end{theorem}

\subsection{Proof of the Bubble Theorem}
We begin with a proof of the bubble theorem, which is the crux result of the alternating case.  Indeed, both of the subsequent theorems are fairly straightforward consequences of this theorem.

It's interesting to note that the Bubble Theorem is intuitively very natural.  The main difficulty is finding a clean way to handle the special cases generated by the convoluted geometry.

\begin{proof}[Proof of Theorem \ref{thm:bubble}]
	Take a bubble $B$ and assume without loss of generality that it is blue.  It is easy to see, by considering two anchors on the boundary of blue, that there is some red anchor inside $B$.  This implies that $B$ has at least one red caterpillar.

	Next, it is easy to verify that all caterpillars held inside $B$ are red, otherwise this contradicts the construction of Libedinsky's light leaves.

	Define a pair of red anchors $u, v$, with $u$ to the left of $v$, to be \emph{quasi-connected} if (i) one can draw an arc from $u$ to $v$ contained entirely in one half-map which does not intersect blue lines, and (ii) there is no red anchor $w$ strictly between $u$ and $v$ for which one can draw a similar arc on the same half-map joining $w$ and $v$.

	Now we claim that \textbf{any quasi-connected pair of red anchors is actually joined by a single arc}.  To prove this, take such a quasi-connected pair $u$ and $v$.  Now we'll focus only on the half-map in which the prescribed arc is drawn.  We thus may state that an arc \emph{shields} any anchors which lie between its endpoints.
	
	\begin{figure}[ht]
		\centering
		\begin{asy}
			size(6cm);
			pen s = blue, t = red + dashed + 0.6;
			pen dot_s = blue, dot_t = red;
			for (int i=0; i<=8; i+=2) { dot( (i,0), dot_s ); }
			for (int i=1; i<=8; i+=2) { dot( (i,0), dot_t ); }
			draw((0,0)..(1,2)..(3,4)..(5,3)..(6,5)..(7,2)..(8,0), s);
			draw((1,0)..(3,2)..(5,0), t); // red covering arc
			draw((2,0)..(3,1)..(4,0), s); // blue covering arc again
			label("$u$", (3,0), dir(-90));
			label("$v$", (5,0), dir(-90));
		\end{asy}
		\hspace{2em}
		\begin{asy}
			size(6cm);
			pen s = blue, t = red + dashed + 0.6;
			pen dot_s = blue, dot_t = red;
			for (int i=0; i<=8; i+=2) { dot( (i,0), dot_s ); }
			for (int i=1; i<=8; i+=2) { dot( (i,0), dot_t ); }
			draw((0,0)..(1,2)..(3,4)..(5,3)..(6,5)..(7,2)..(8,0), s);
			draw((1,0)..(4,2)..(7,0), t); // red covering arc
			draw((2,0)..(4,1)..(6,0), s); // blue covering arc
			label("$u$", (3,0), dir(-90));
			label("$v$", (5,0), dir(-90));
		\end{asy}
		\caption{Proving the bubble theorem with quasi-connected vertices.}
		\label{fig:pf_bubble}
	\end{figure}
	Because the string is alternating, we can take a blue anchor $x$ immediately to the left of $v$.  Now, there must be some blue arc shielding $u$ and $v$ (since $u,v$ are inside a blue bubble).  By the light-leave construction, there must be some red arc $A$ covering $x$.  If this arc joins $u$ and $v$, then we are done.  
	Otherwise, if it has endpoint $v$ then it must completely cover $u$ by condition (ii) of quasi-connectedness; if not, then it must completely cover $v$.  This leads us to two cases.
	\begin{itemize}
		\ii If the arc covers exactly one of $u$ or $v$, say $u$, then there must be a blue arc shielding $u$ from $A$.  But then this contradicts the quasi-connectedness, because now it is not possible to join $u$ and $v$ by an arc on this half-map.  This case is illustrated by the left half of figure \ref{fig:pf_bubble}.
		\ii If the arc covers both $u$ and $v$, then there must be a blue arc which shields both $u$ and $v$, which is itself shielded by $A$.  Then we can repeat the same procedure with this new blue arc.  This case is illustrated by the right half of figure \ref{fig:pf_bubble}.
	\end{itemize}
	Therefore any pair of quasi-connected anchors must be connected by an arc.  However, one can verify that the red anchors in $B$ but not in any other blue bubble are ``connected'' under quasi-connectedness.\footnote{That is, one can follow a sequence of red anchors, each consecutive pair quasi-connected, from any red anchor to any other red anchor.}  Therefore all such red anchors must be connected.  So there is a single caterpillar, as desired.
\end{proof}

\subsection{Proof of the Caterpillar Theorem}
We will now derive the Caterpillar Theorem as a consequence of the Bubble Theorem.  

First, a few definitions for this section only.
\begin{definition*}
	Consider a caterpillar $C$ in a full-diagram with base $\AA_n$.  Define the \emph{nesting level} of the caterpillar as the largest integer $n$ for which there exists caterpillars $C = C_0$, $C_1$, $C_2$, $\dots$, $C_n$ such that $C_i$ holds $C_{i+1}$ for each $i=0,1,\dots,n-1$.  Define the \emph{size} of the caterpillar to be the number of bubbles it contains.
\end{definition*}

\begin{proof}[Proof of Theorem \ref{thm:caterpillar}]
	The proof is by double induction.  First we will consider caterpillars with nesting level $0$.  

	We perform induction on the size of the caterpillar. 
	If there are no bubbles, then the caterpillar is simply a barbell (because it is a tree, which contracts to a barbell).
	This is the base step.
	For the inductive step, consider an arbitrary bubble.  Inside it is exactly one caterpillar, say $c$, by the Bubble Theorem.  Because the original caterpillar has nesting level $0$, we deduce $c$ is merely a barbell, and hence is either $\alpha_s$ or $\alpha_t$.
	Applying the barbell-forcing rule of equation \eqref{eq:barbell_break} generates two terms.  One of them is zero because it creates a new empty bubble. The other is the original diagram with the cycle cut open and the contents removed, multiplied by one of $\left\{ x,y \right\}$.  The inductive hypothesis now applies directly, and this completes the first induction.

	Now suppose a caterpillar has nesting level $k \ge 1$.  We simply apply the exact same induction on size as before.  The only modification is that, instead of a barbell, we have a caterpillar with nesting level strictly less than $k$.  However, these caterpillars all evaluate as a polynomial again of the form $x^my^n \alpha_s$ or $x^my^n\alpha_t$, by the outer inductive hypothesis.  So applying equation \eqref{eq:barbell_break} in the same manner completes this induction as well.
\end{proof}

\subsection{Proof of the Pasture Theorem}
\begin{figure}[ht]
	\centering
	\begin{asy}
		size(11cm);
		real h = 0.7;
		pen s = blue, t = red + dashed + 0.6;
		pen dot_s = blue, dot_t = red;
		int n = 6;

		picture before;
		draw(before, (1,0)--(1,h/2)..((1+3)/2.0,h*2)..(3,h/2)--(3,0), t);
		draw(before, (2,0)--(2,h), s);
		dot(before, (2,h), dot_s);
		draw(before, (5,0)--(5,h), t);
		dot(before, (5,h), dot_t);
		draw(before,(0,0)--(0,3*h), s);
		draw(before,(3,0)--(3,3*h), t);
		draw(before,(4,0)--(4,3*h), s);
		dot(before, (3, h/2), dot_t);

		add(before); add(reflect((0,0),(1,0))*before);
		draw((-1,0)--(6,0));

		picture after;
		draw(after, (1,0)--(1,h/2)..((1+3)/2.0,h*2)..(3,h/2)--(3,0), t);
		draw(after, (4,0)--(4,h/2)..((4+6)/2.0,h*2)..(6,h/2)--(6,0), s);
		draw(after, (3,0)--(3,h/2)..((3+7)/2.0,h*4)..(7,h/2)--(7,0), t);
		draw(after, (0,0)--(0,h/2)..((0+8)/2.0,h*5.5)..(8,h/2)--(8,0), s);
		draw(after, (2,0)--(2,h), s);
		dot(after, (2,h), dot_s);
		draw(after, (5,0)--(5,h), t);
		dot(after, (5,h), dot_t);
		dot(after, (3, h/2), dot_t);

		add(shift((9,0)) * after);
		add(shift((9,0)) * reflect((0,0),(1,0))*after);
		draw((8,0)--(18,0));

		label("$\to$", (7,0));
	\end{asy}
	\caption{In the first diagram, $\ul a = \ul b = 110010$.  In the second, $\ul a' = \ul b' = 110010111$.  Closing the pastures allows us to deduce the Pasture Theorem from the Bubble Theorem.}
	\label{fig:pf_pasture}
\end{figure}
The bubble theorem and the pasture theorem are structurally very similar.  In fact, we will now show a somewhat surprising proof that the Pasture Theorem follows from the Bubble Theorem.
\begin{proof}[Proof of Theorem \ref{thm:pasture}]
	Again, let $T$ denote the top, with length $N$.  In the first case, suppose $T[N] \neq \AA_n[n]$; that is, the last characters of $T$ and $\AA_n$ differ.  Then it must be the case that the rightmost anchor is not part of a fence.
	Now suppose the map arose from $\MM_{\AA_n}(\ul a, \ul b)$.  Let $\ul a'$ be the string formed by appending $N$ $1$'s to $\ul a$, and define $\ul b'$ similarly.  Now consider the map \[ \MM_{\AA_{n+N}} \left( \ul a', \ul b' \right). \]  See figure \ref{fig:pf_pasture} for an example.

	It is easy to verify that the top of this new map is zero.  Now what we have done is enclose the contents of each pasture into bubbles.  The Bubble Theorem tells us that the innermost bubble can have exactly one caterpillar, while the other bubbles must contain only a single caterpillar, which was once a fence.  This implies the Pasture Theorem in the first case.

	The case where $T[N] = \AA_n[n]$ is similar.  We simply append a zero followed by $N$ $1$'s and repeat the same procedure.  The only difference is that the innermost barbell was generated by the $0$ we appended, and thus was not part of the original diagram.
\end{proof}


\section{A Recursion for the Alternating Case}
\label{sec:res_altrecurse}
In this section we present a limited recursion for computing $\MM_{\AA_n}(\ul a, \ul b)$.  This recursion is sufficient to calculate $\MM_{\AA_n}(\ul b, \ul b)$.

\begin{proposition}
	BLAH
	\label{thm:recurse}
\end{proposition}

\section{Conclusion}
% The conclusion should be a brief summary of what you have done.  You wish to leave the reader with a clear impression of your ideas and what you have accomplished.  This section is typically extremely short and in the past tense.

\section{Acknowledgments} 
I wish to thank the MIT Math Department for organizing the Math RSI, and in particular the head mentor Dr. Tanya Khovanova (MIT) for providing individual discussion with me.
I also wish to thank my tutor Mr. Antoni Rangachev (Northeaster University) for his invaluable advice in preparing both this paper and my final presentation.
I would also like to thank the Center for Excellence in Education and the Research Science Institute, as well as the Massachusetts Institute of Technology, for generously providing the facilities for the research.

Finally, I offer my sincerest gratitude to my mentor Mr. Francisco Unda (MIT) for daily mentorship, and Professor Benjamin Elias (MIT), for providing the project and for often meeting with me personally to discuss it.
That sounded horribly fake, but I really mean it.  You guys are the best.  Thank you for a great project.
